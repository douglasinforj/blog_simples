{% extends "base.html" %}
{% block title %}{{ post.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="mb-4">
        <h1 class="mb-3">{{ post.title }}</h1>
        <p class="text-muted">
            Publicado por <strong>{{ post.author }}</strong>
            em {{ post.published_date|date:"d/m/Y H:i" }}
        </p>
        <hr>
        <p class="fs-5">{{ post.text|linebreaks }}</p>
    </div>

    <div class="d-flex gap-2">
        {% if user.is_authenticated and user == post.author %}
            <a href="{% url 'post_edit' post.pk %}" class="btn btn-outline-primary btn-sm">Editar</a>
        {% endif %}
        <a href="{% url 'post_list' %}" class="btn btn-secondary btn-sm">Voltar</a>
    </div>

    <hr>
    <div id="votos">
        <button id="like-btn">Gostei 👍 (<span id="like-count">{{ post.likes }}</span>)</button>
        <button id="dislike-btn">Não Gostei 👎 (<span id="dislike-count">{{ post.dislikes }}</span>)</button>
      </div>
    <div id="mensagem-voto" style="color: red;"></div>

    {% block extra_js %}

    <script>
        const postId = {{ post.id }};
        const csrfToken = '{{ csrf_token }}';
    
        function votar(tipo) {
            fetch(`/votar/${postId}/${tipo}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                }
            }).then(response => {
                return response.json().then(data => ({ status: response.status, body: data }));
            }).then(({ status, body }) => {
                if (status === 200) {
                    // Atualiza os contadores na tela
                    document.getElementById('like-count').textContent = body.likes;
                    document.getElementById('dislike-count').textContent = body.dislikes;
    
                    // Desativa os botões
                    document.getElementById('like-btn').disabled = true;
                    document.getElementById('dislike-btn').disabled = true;
                } else {
                    document.getElementById('mensagem-voto').textContent = body.error || 'Erro ao votar.';
                }
            });
        }
    
        document.getElementById('like-btn').addEventListener('click', () => votar('like'));
        document.getElementById('dislike-btn').addEventListener('click', () => votar('dislike'));
    </script>
    
    {% endblock %}
    

    
</div>
{% endblock %}

